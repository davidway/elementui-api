package com.blockchain.util;

import org.springframework.stereotype.Component;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.blockchain.DTO.AssetIssue;
import com.blockchain.DTO.AssetSettle;
import com.blockchain.DTO.AssetTransfer;
import com.blockchain.VO.AssetSettleForm;
import com.blockchain.VO.AssetSettleSubmitForm;
import com.blockchain.VO.AssetSubmitForm;
import com.blockchain.VO.AssetTransferForm;
import com.blockchain.VO.AssetTransferSubmitForm;

@Component
public class AssetPrepareUtil {

	public AssetSubmitForm prepareAssetSubmitForm(String applyResultString) {
		JSONObject o = JSON.parseObject(applyResultString);
		AssetSubmitForm assetSubmitForm = new AssetSubmitForm();
		String signStrList = o.getString("sign_str_list");
		assetSubmitForm.setSignStr(signStrList);
		String transactionId = o.getString("transaction_id");
		assetSubmitForm.setTransactionId(transactionId);
		String assetId = o.getString("asset_id");
		assetSubmitForm.setAssetId(assetId);
		return assetSubmitForm;
		
	}

	public AssetTransferSubmitForm perpareTransferSubmitForm(AssetTransferForm assetTransferForm, String applyResultString) {
		AssetTransferSubmitForm s = new AssetTransferSubmitForm();
		s.setUserPrivateKey(assetTransferForm.getUserPrivateKey());
		
		JSONObject o = JSON.parseObject(applyResultString);
		String transtionId = o.getString("transaction_id");
		String signList = o.getString("sign_str_list");
		
		s.setTransactionId(transtionId);
		s.setSignList(signList);
		return s;
	}

	public AssetSettleSubmitForm perpareTransferSubmitForm(AssetSettleForm assetSettleForm, String applyResultString) {
		AssetSettleSubmitForm s = new AssetSettleSubmitForm();
		s.setUserPrivateKey(assetSettleForm.getUserPrivateKey());
		
		JSONObject o = JSON.parseObject(applyResultString);
		String transtionId = o.getString("transaction_id");
		String signList = o.getString("sign_str_list");
		
		s.setTransactionId(transtionId);
		s.setSignList(signList);
		return s;
	}

	public AssetTransfer generateAssetTransferDTO(AssetTransferSubmitForm asseTransfertSubmitForm, String submitResultString) {
		AssetTransfer assetTransfer = new AssetTransfer();
		
		JSONObject json = JSONObject.parseObject(submitResultString);
		String dstAssetId = json.getString("dst_asset_id");
		String dstAssetAmount = json.getString("dst_asset_amount	");
		String srcAssetId = json.getString("left_asset_id");
		String feeAssetId = json.getString("fee_asset_id");
		String leftAssetAmount = json.getString("left_asset_amount");
		String transHash = json.getString("trans_hash");
		String feeAssetAmount = json.getString("fee_asset_amount");

		String transactionId = asseTransfertSubmitForm.getTransactionId();
		assetTransfer.setTransHash(transHash);
		assetTransfer.setFeeAssetAmount(feeAssetAmount);
		assetTransfer.setSrcAmount(leftAssetAmount);
		assetTransfer.setDstAssetAmount(dstAssetAmount);
		assetTransfer.setDstAssetId(dstAssetId);
		assetTransfer.setFeeAssetId(feeAssetId);
		assetTransfer.setSrcAssetId(srcAssetId);
		assetTransfer.setTransactionId(transactionId);
		return assetTransfer;
	}

	public AssetSettle generateAssetSettleDTO(AssetSettleSubmitForm assetSettleSubmitForm, String submitResultString) {
		AssetSettle assetSettle = new AssetSettle();
		
		String transactionId = assetSettleSubmitForm.getTransactionId();
		JSONObject json = JSONObject.parseObject(submitResultString);
		String leftAssetId = json.getString("left_asset_id");
		String transHash = json.getString("trans_hash");
		assetSettle.setTransHash(transHash);
		assetSettle.setSrcAssetId(leftAssetId);
		assetSettle.setTransactionId(transactionId);
		 return assetSettle;
	}

	public AssetIssue generateAssetIssueDto(AssetSubmitForm assetSubmitForm, String submitResultString) {
		AssetIssue assetIssue = new AssetIssue();
		
		String transactionId = assetSubmitForm.getTransactionId();
		String assetId = JSON.parseObject(submitResultString).getString("asset_id");
		String transHash = JSON.parseObject(submitResultString).getString("trans_hash");
		
		
		assetIssue.setTransactionId(transactionId);
		assetIssue.setAssetId(assetId);
		assetIssue.setTransHash(transHash);
		
		return assetIssue;
	}

}
